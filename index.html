<!DOCTYPE html>
<html lang="ro">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Enjoy Padel – Rezervări</title>
  <style>
    :root{
      --bg:#0a0f0d; --fg:#eaf5ef; --muted:#95a7ad;
      --panel:#0f1519; --line:#1f2a32; --chip:#0e1418;
      --green:#22c55e; --blue:#2563eb; --red:#ef4444;
      --free:#1a242b; --busy:#121a1f;
    }
    *{box-sizing:border-box} html,body{height:100%}
    body{margin:0;background:var(--bg);color:var(--fg);font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}

    /* NAV */
    nav{position:fixed;inset:0 0 auto 0;z-index:50;display:flex;align-items:center;justify-content:space-between;padding:16px clamp(18px,4vw,48px);background:rgba(0,0,0,.55);backdrop-filter:blur(10px);border-bottom:1px solid rgba(255,255,255,.06)}
    .brand{font-weight:900;letter-spacing:.5px}
    .brand b{color:var(--green)}
    nav a{color:#e9f4ef;text-decoration:none;margin-left:18px;font-weight:600;opacity:.95}
    nav a:hover{opacity:1}

    /* HERO */
    header.hero{margin-top:64px;min-height:92vh;position:relative;display:grid;place-items:center;text-align:center;width:100vw;left:50%;right:50%;margin-left:-50vw;margin-right:-50vw;background:linear-gradient(rgba(0,0,0,.45), rgba(0,0,0,.6)), url('./hero.png') center/cover no-repeat}
    header .wrap{max-width:1100px;padding:0 clamp(16px,4vw,48px)}
    h1{font-size:clamp(32px,6vw,60px);margin:.2rem 0 .7rem;color:var(--green)}
    .lead{max-width:900px;margin:0 auto 18px;line-height:1.6;font-size:clamp(16px,2.2vw,19px)}
    .btn{display:inline-flex;align-items:center;gap:10px;padding:14px 24px;border-radius:999px;border:1px solid #2b3c46;background:var(--green);color:#04170d;font-weight:900;text-decoration:none;cursor:pointer}
    .btn:hover{filter:brightness(1.05)}

    /* SECTION */
    .section{margin:28px auto;padding:24px clamp(16px,4vw,40px);width:100%;max-width:1100px;background:var(--panel);border:1px solid var(--line);border-radius:18px}
    .steps{display:grid;gap:16px}
    .step{background:var(--chip);border:1px solid var(--line);border-radius:14px;padding:16px}
    .title{font-weight:800;margin:0 0 10px}
    .hint{font-size:12px;color:var(--muted);margin-top:6px}

    /* COURT PICKER */
    .court-buttons{display:flex;gap:10px;flex-wrap:wrap}
    .court{padding:10px 14px;border-radius:12px;border:1px solid var(--line);background:#0b1216;color:#eaf5ef;cursor:pointer;font-weight:700}
    .court.active{outline:2px solid var(--blue);background:rgba(37,99,235,.12)}

    /* DATE PICKER compact */
    .date-row{display:flex;align-items:center;gap:12px;flex-wrap:wrap}
    input[type="date"]{background:#0a0f0d;color:var(--fg);border:1px solid var(--line);border-radius:10px;padding:10px 12px}

    /* START MINUTE TOGGLE */
    .startmin{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin:8px 0}
    .min-label{font-size:13px;color:var(--muted)}
    .min-btn{padding:8px 12px;border-radius:10px;border:1px solid var(--line);background:#0c1216;color:#eaf5ef;cursor:pointer;font-weight:700}
    .min-btn.active{background:linear-gradient(90deg,var(--green),#38bdf8);color:#02140b;border-color:transparent}

    /* HOUR LIST + DURATION */
    .hours{display:grid;grid-template-columns:repeat(auto-fill,minmax(90px,1fr));gap:10px}
    .slot{position:relative;padding:12px;border-radius:12px;border:1px dashed #23313a;background:var(--free);color:#dfe8ec;text-align:center;font-weight:800;cursor:pointer}
    .slot.busy{background:var(--busy);color:#7e8b92;border-style:solid;cursor:not-allowed}
    .slot.selected{outline:2px solid var(--blue)}

    .durations{display:flex;gap:8px;flex-wrap:wrap;margin-top:10px}
    .dur{padding:8px 12px;border-radius:10px;border:1px solid var(--line);background:#0c1216;color:#eaf5ef;cursor:pointer;font-weight:700}
    .dur.active{background:linear-gradient(90deg,var(--green),#38bdf8);color:#02140b;border-color:transparent}

    /* overlays pentru intervalul selectat */
    .overlay-full{position:relative}
    .overlay-full::after{content:'';position:absolute;inset:2px;border-radius:10px;background:linear-gradient(90deg,rgba(34,197,94,.18),rgba(56,189,248,.20));pointer-events:none}
    .overlay-left{position:relative}
    .overlay-left::after{content:'';position:absolute;top:2px;bottom:2px;left:2px;width:50%;border-top-left-radius:10px;border-bottom-left-radius:10px;background:linear-gradient(90deg,rgba(34,197,94,.18),rgba(56,189,248,.20));pointer-events:none}
    .overlay-right{position:relative}
    .overlay-right::after{content:'';position:absolute;top:2px;bottom:2px;right:2px;width:50%;border-top-right-radius:10px;border-bottom-right-radius:10px;background:linear-gradient(90deg,rgba(34,197,94,.18),rgba(56,189,248,.20));pointer-events:none}

    .legend{display:flex;gap:10px;align-items:center;font-size:12px;color:var(--muted)}
    .dot{width:12px;height:12px;border-radius:50%}
    .dot.free{background:#24323a;border:1px dashed #2b3a44}
    .dot.busy{background:#121a1f;border:1px solid #22313a}
    .dot.sel{background:linear-gradient(90deg,var(--green),#38bdf8)}

    /* SUMMARY */
    .summary{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:center;margin-top:10px}
    @media (max-width:700px){.summary{grid-template-columns:1fr}}
  </style>
</head>
<body>
  <!-- NAV -->
  <nav>
    <div class="brand">ENJOY <b>PADEL</b></div>
    <div>
      <a href="#rezerva">Rezervă</a>
      <a href="#" target="_blank" rel="noopener">Instagram</a>
      <a href="#" target="_blank" rel="noopener">TikTok</a>
    </div>
  </nav>

  <!-- HERO -->
  <header class="hero">
    <div class="wrap">
      <h1>Bine ai venit la Enjoy Padel!</h1>
      <p class="lead">Aici jocul e mereu aprins! Terenuri moderne, energie bună și o comunitate de jucători care iubesc padelul. Fie că vii să te distrezi cu prietenii sau să-ți testezi limitele, te așteptăm să intri în joc și să simți vibe-ul!</p>
      <a href="#rezerva" class="btn" id="cta">Rezervă acum</a>
    </div>
  </header>

  <!-- BOOKING (3 PAȘI, varianta 2) -->
  <section id="rezerva" class="section">
    <div class="steps">
      <!-- PAS 1: TEREN -->
      <div class="step">
        <h3 class="title">Pasul 1: Alege terenul</h3>
        <div class="court-buttons">
          <button class="court active" data-court="1">Teren 1</button>
          <button class="court" data-court="2">Teren 2</button>
        </div>
        <div class="hint">Poți schimba oricând – actualizăm automat disponibilitatea orelor.</div>
      </div>

      <!-- PAS 2: DATA -->
      <div class="step">
        <h3 class="title">Pasul 2: Selectează data</h3>
        <div class="date-row">
          <input type="date" id="datePicker" />
        </div>
      </div>

      <!-- PAS 3: ORE + DURATĂ + START LA :00/:30 -->
      <div class="step">
        <h3 class="title">Pasul 3: Alege ora</h3>
        <div class="legend" style="margin-bottom:8px">
          <span class="dot free"></span> liber
          <span class="dot busy"></span> ocupat
          <span class="dot sel"></span> selectat
        </div>

        <div class="startmin">
          <span class="min-label">Start la:</span>
          <button class="min-btn active" data-min="0">:00</button>
          <button class="min-btn" data-min="30">:30</button>
        </div>

        <div id="hourList" class="hours"></div>

        <div class="durations">
          <button class="dur active" data-min="60">60 min</button>
          <button class="dur" data-min="90">90 min</button>
          <button class="dur" data-min="120">120 min</button>
        </div>

        <div class="summary">
          <div id="selSummary">—</div>
          <button class="btn" id="continueBtn">Continuă</button>
        </div>
        <div class="hint">Duratele mai lungi (ex. 90/120 min) arată doar orele de start unde **toate** jumătățile de oră consecutive sunt libere (inclusiv bufferul opțional).</div>
      </div>
    </div>
  </section>

  <script>
  /* ===== CONFIG (varianta 2, granularitate 30 min) ===== */
  const PROGRAM_START = 6;    // 06:00 inclusiv
  const PROGRAM_END   = 23;   // 23:00 = ultima oră de start posibilă doar dacă încape durata
  const STEP = 30;            // granularitate de 30 min
  const BUFFER_MIN = 0;       // seteză 0 sau 30/60 pentru pauză între rezervări

  /* ===== TARIFE (dinamic, pe oră) ===== */
  function isWeekend(dateStr){
    const d=new Date(dateStr+"T00:00:00");
    const day=d.getDay();
    return day===0||day===6;
  }
  function hourlyRate(dateStr, hour){
    if(isWeekend(dateStr)){
      if(hour<8) return 80; if(hour<12) return 100; if(hour<18) return 120; return 140;
    } else {
      if(hour<8) return 60; if(hour<18) return 80; return 100;
    }
  }
  function priceBetween(start,end){
    let total=0; const cur=new Date(start);
    while(cur<end){
      const stepEnd=new Date(cur);
      const stepMin=Math.min(60-cur.getMinutes(),(end-cur)/60000);
      stepEnd.setMinutes(stepEnd.getMinutes()+stepMin);
      const rate=hourlyRate(localYMD(cur),cur.getHours());
      total+=rate*(stepMin/60);
      cur.setTime(stepEnd.getTime());
    }
    return Math.round(total);
  }

  /* ===== STATE ===== */
  const dateEl = document.getElementById('datePicker');
  const hourList = document.getElementById('hourList');
  const selSummary = document.getElementById('selSummary');
  const continueBtn = document.getElementById('continueBtn');

  let court = 1;
  let dateStr = null;       // YYYY-MM-DD
  let startHour = null;     // 0..23
  let startMinute = 0;      // 0 sau 30
  let duration = 60;        // 60, 90, 120

  // disponibilitate pe jumătăți (0..47) pentru zi + teren
  let busyHalves = new Set();

  /* ===== HELPERS ===== */
  function todayYMD(){
    const d=new Date();
    const m=String(d.getMonth()+1).padStart(2,'0');
    const day=String(d.getDate()).padStart(2,'0');
    return `${d.getFullYear()}-${m}-${day}`;
  }
  function localYMD(d){
    const y=d.getFullYear(); const m=String(d.getMonth()+1).padStart(2,'0'); const day=String(d.getDate()).padStart(2,'0');
    return `${y}-${m}-${day}`;
  }
  function labelDate(ymd){
    const d=new Date(ymd+"T00:00:00");
    return d.toLocaleDateString('ro-RO',{weekday:'long', day:'2-digit', month:'long', year:'numeric'});
  }

  /* ===== API HOOKS (conform planului: GET /availability, POST /bookings) ===== */
  async function fetchAvailability(ymd, courtId){
    // >>> În producție: deblochează codul de mai jos și conectează la server.
    /*
    const url = `/availability?court=${courtId}&date=${ymd}&step=${STEP}`;
    const res = await fetch(url);
    if(!res.ok) throw new Error('Availability fetch failed');
    const json = await res.json(); // { busyHalves: number[] } sau { bookings:[{start:"HH:MM", end:"HH:MM"}] }
    return new Set(json.busyHalves);
    */
    // --- DEMO fallback (simulator) — ocupă ore întregi determinate de un seed:
    return simulateBusyHalves(ymd, courtId);
  }

  async function postBooking(payload){
    // payload: { courtId, date, start:"HH:MM", duration: minutes }
    // >>> În producție: trimite la server; acesta REVALIDEAZĂ și confirmă/respinge.
    /*
    const res = await fetch('/bookings', {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    if(!res.ok){ const t=await res.text(); throw new Error(t||'Booking failed'); }
    return await res.json();
    */
    // DEMO: revalidează local și "confirmă":
    const [h,m] = payload.start.split(':').map(Number);
    if(!canBook(dateStr,h,m,duration)) throw new Error('Interval indisponibil (revalidare).');
    return { ok:true, bookingId: Math.random().toString(36).slice(2) };
  }

  /* ===== Simulare disponibilitate fallback ===== */
  function simulateBusyHalves(ymd, courtId){
    const d = new Date(ymd+"T00:00:00");
    const seed = (d.getDate()+d.getMonth()+1 + (courtId*7)) % 5; // 0..4
    const patterns = [ [9,18], [8,10,19], [7,12,20], [6,14,21,22], [11,13,17] ]; // ore ocupate (ambele jumătăți)
    const set = new Set();
    (patterns[seed]||[]).forEach(h=>{ set.add(h*2); set.add(h*2+1); });
    return set;
  }

  /* ===== Logică disponibilitate conform planului (30 min + durate) ===== */
  function halfIndexFrom(h,m){ return h*2 + (m===30?1:0); }

  function canBook(ymd, startH, startM, minutes){
    if(minutes % STEP !== 0) return false;
    const halvesNeed = minutes / STEP;
    const startHalf = halfIndexFrom(startH, startM);

    // în program (start >= open)
    if(startHalf < PROGRAM_START*2) return false;

    // end ≤ ora închidere
    const endHalf = startHalf + halvesNeed;
    const maxHalf = PROGRAM_END * 2 + 2; // ex: la 23:00, ultimul half index valid pentru END exact (depinde de durată). Mai jos verificăm cu buffer.
    if(endHalf > maxHalf) return false;

    // buffer: necesar N jumătăți libere după rezervare
    const bufferHalves = Math.ceil(BUFFER_MIN / STEP);

    // verifică suprapunere cu ocupările existente
    for(let k=0;k<halvesNeed;k++){
      const half = startHalf + k;
      if(busyHalves.has(half)) return false;
    }
    // verifică buffer (dacă nu depășește ziua și programul)
    for(let b=0;b<bufferHalves;b++){
      const chk = endHalf + b;
      if(chk >= 48) return false; // nu depășim ziua
      if(chk > PROGRAM_END*2+1) return false; // după program
      if(busyHalves.has(chk)) return false;
    }
    return true;
  }

  function buildHours(){
    hourList.innerHTML='';
    if(!dateStr){ selSummary.textContent='Alege o dată.'; return; }

    for(let h=PROGRAM_START; h<=PROGRAM_END; h++){
      const btn = document.createElement('button');
      btn.className='slot';
      btn.textContent = `${String(h).padStart(2,'0')}:00`;
      btn.dataset.h = h;

      const available = canBook(dateStr,h,startMinute,duration);
      if(!available){ btn.classList.add('busy'); btn.disabled=true; btn.title='Indisponibil pentru durata aleasă'; }
      if(startHour===h) btn.classList.add('selected');

      btn.onclick = ()=>{ if(btn.disabled) return; startHour=h; updateOverlay(); updateSummary(); };
      hourList.appendChild(btn);
    }
    updateOverlay();
  }

  // marchează vizual orele acoperite, inclusiv jumătăți (left/right/full)
  function updateOverlay(){
    [...hourList.children].forEach(el=>{el.classList.remove('overlay-full','overlay-left','overlay-right');});
    if(startHour==null) return;
    const halves = duration/30;
    const startHalf = halfIndexFrom(startHour, startMinute);

    const affected = new Map(); // hour -> {left,right}
    for(let k=0;k<halves;k++){
      const half = startHalf + k; const hour = Math.floor(half/2); const side = (half%2===0)?'left':'right';
      if(!affected.has(hour)) affected.set(hour,{left:false,right:false});
      affected.get(hour)[side] = true;
    }

    for(const [hour, sides] of affected.entries()){
      const el = [...hourList.children].find(x=>Number(x.dataset.h)===hour);
      if(!el) continue;
      if(sides.left && sides.right) el.classList.add('overlay-full');
      else if(sides.left) el.classList.add('overlay-left');
      else if(sides.right) el.classList.add('overlay-right');
    }
  }

  function updateSummary(){
    if(!dateStr || startHour==null){ selSummary.textContent='—'; return; }
    const start = new Date(dateStr+"T00:00:00"); start.setHours(startHour,startMinute,0,0);
    const end = new Date(start); end.setMinutes(end.getMinutes()+duration);
    const fmt=dt=>`${String(dt.getHours()).padStart(2,'0')}:${String(dt.getMinutes()).padStart(2,'0')}`;
    const extra = end.getDate()!==start.getDate() ? " (ziua următoare)" : "";
    const total = priceBetween(start,end);
    const bufferTxt = BUFFER_MIN ? ` • Buffer: ${BUFFER_MIN} min` : "";
    selSummary.textContent = `Data: ${labelDate(dateStr)} • Teren ${court} • ${fmt(start)} – ${fmt(end)}${extra} • Total: ${total} lei${bufferTxt}`;
  }

  /* ===== EVENTS ===== */
  document.querySelectorAll('.court').forEach(b=>{
    b.addEventListener('click',async ()=>{
      document.querySelectorAll('.court').forEach(x=>x.classList.remove('active'));
      b.classList.add('active');
      court = Number(b.dataset.court);
      startHour = null;
      busyHalves = await fetchAvailability(dateStr, court);
      buildHours(); updateSummary();
    });
  });

  document.querySelectorAll('.min-btn').forEach(mb=>{
    mb.addEventListener('click',()=>{
      document.querySelectorAll('.min-btn').forEach(x=>x.classList.remove('active'));
      mb.classList.add('active');
      startMinute = Number(mb.dataset.min); // 0 sau 30
      if(dateStr && startHour!=null && !canBook(dateStr,startHour,startMinute,duration)) startHour=null;
      buildHours(); updateOverlay(); updateSummary();
    });
  });

  document.querySelectorAll('.dur').forEach(d=>{
    d.addEventListener('click',()=>{
      document.querySelectorAll('.dur').forEach(x=>x.classList.remove('active'));
      d.classList.add('active');
      duration = Number(d.dataset.min);
      if(dateStr && startHour!=null && !canBook(dateStr,startHour,startMinute,duration)) startHour=null;
      buildHours(); updateOverlay(); updateSummary();
    });
  });

  dateEl.addEventListener('change', async ()=>{
    dateStr = dateEl.value || null;
    startHour = null;
    busyHalves = dateStr ? await fetchAvailability(dateStr, court) : new Set();
    buildHours(); updateOverlay(); updateSummary();
  });

  continueBtn.addEventListener('click', async ()=>{
    if(!dateStr || startHour==null){ alert('Te rog selectează data, ora și durata.'); return; }
    if(!canBook(dateStr,startHour,startMinute,duration)){ alert('Interval indisponibil. Te rog alege altă combinație.'); return; }

    const start = new Date(dateStr+"T00:00:00"); start.setHours(startHour,startMinute,0,0);
    const end = new Date(start); end.setMinutes(end.getMinutes()+duration);
    const fmt=dt=>`${String(dt.getHours()).padStart(2,'0')}:${String(dt.getMinutes()).padStart(2,'0')}`;

    try{
      const payload = { courtId: court, date: dateStr, start: fmt(start), duration };
      const res = await postBooking(payload); // REVALIDARE pe server
      alert(`Rezervare confirmată!\nID: ${res.bookingId}\nTeren ${court}\n${labelDate(dateStr)}\n${fmt(start)} – ${fmt(end)}`);
      // după confirmare, refetch disponibilitate ca să blochezi intervalul:
      busyHalves = await fetchAvailability(dateStr, court);
      startHour = null;
      buildHours(); updateSummary();
    }catch(e){
      alert(e.message || 'A apărut o eroare la rezervare.');
    }
  });

  // init
  async function init(){
    const today=todayYMD();
    dateEl.value = today; dateEl.min=today; dateStr=today;
    busyHalves = await fetchAvailability(dateStr, court);
    buildHours(); updateOverlay(); updateSummary();
  }
  init();

  // scroll la rezervări
  document.getElementById('cta').addEventListener('click', (e)=>{
    e.preventDefault(); document.getElementById('rezerva').scrollIntoView({behavior:'smooth'});
  });
  </script>
</body>
</html>
